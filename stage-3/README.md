# Minic阶段3：变量作用域与存储管理

## 🎯 学习目标
- 实现变量声明与赋值
- 理解变量作用域规则
- 掌握栈式存储管理
- 支持标识符表达式

## 🚀 快速开始

### 获取阶段3代码
```bash
git clone https://github.com/zhnt/minic-student.git
cd minic-student/stage-3
make
```

### 测试变量功能
```bash
echo "x = 42; x" | ./src/minic  # 42.00
echo "x = 5; y = 10; x + y" | ./src/minic  # 15.00
```

## 📚 30分钟学习指南

### 第1步：理解变量存储（10分钟）
变量在编译器中的处理流程：
1. **词法分析**：识别标识符和关键字
2. **语法分析**：构建变量声明/赋值语法树
3. **语义分析**：检查变量作用域和类型
4. **代码生成**：分配存储空间，生成访问代码

### 第2步：实现变量支持（15分钟）
需要修改：
- `src/lexer.c` - 添加IDENTIFIER token
- `src/parser.c` - 处理变量声明和赋值语句
- `src/compiler.c` - 实现变量存储和加载
- `src/vm.c` - 扩展虚拟机支持变量操作

### 第3步：验证变量功能（5分钟）
```bash
# 基础变量使用
echo "a = 10; a * 2" | ./src/minic  # 20.00

# 复合表达式
echo "price = 100; tax = 0.1; price * (1 + tax)" | ./src/minic  # 110.00
```

## 🔍 实现重点

### 1. 标识符token
```c
TOKEN_IDENTIFIER,  // 变量名标识符
```

### 2. 变量语法规则
```c
// 赋值语句
assignment → IDENTIFIER "=" expression
```

### 3. 存储管理
```c
// 变量值存储在栈中
// 通过变量名索引访问
```

## 🎯 完成标准
- [ ] 支持变量声明和赋值语法
- [ ] 正确处理标识符表达式
- [ ] 实现基本的变量作用域
- [ ] 通过所有测试用例

## 📋 测试用例
```bash
# 基础赋值
echo "x = 42; x" | ./src/minic  # 42.00

# 复合赋值
echo "a = 5; b = 3; a + b * 2" | ./src/minic  # 11.00

# 变量重用
echo "x = 10; x = x + 1; x" | ./src/minic  # 11.00
```

## 📋 解锁下一阶段
完成本阶段后，老师会发布阶段4的代码（条件语句实现）。

## 📊 当前阶段信息
- **阶段**：3/12
- **功能**：变量作用域与存储管理
- **时间**：30分钟学习
- **状态**：已解锁

---
**记住：变量系统是编程语言的核心功能！**